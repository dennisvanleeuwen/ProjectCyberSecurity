# imports for de functie SinglePageScraper
import requests
from bs4 import BeautifulSoup
from bs4 import Comment

# global variabeles
config = 0

# import voor de config lader
import json


# The function scrapes a specific url and checks if there is a match with the defined keywords
def SinglePageScraper(url, keywords):

    result = requests.get(url)
    print(result.status_code)
    c = result.content

    # get comments
    soup = BeautifulSoup(c, 'html.parser')
    comments = soup.find_all(string=lambda text: isinstance(text, Comment))

    positive_keywords = []


    for comment in comments:

        for keyword in keywords:
            if keyword in comment:

                # add positive match to results
                positive_keywords.append(keyword)
                
                # temp test
                # print(comment)
                # print("===========")
                # comment.extract()


    # remove duplicatie keyword matches
    positive_keywords = list(set(positive_keywords))

    # Create string with findings
    string_positive_keywords = ""
    counter = 0
    for positive_keyword in positive_keywords:
        if counter == 0:
            string_positive_keywords = string_positive_keywords + positive_keyword
        else:
            string_positive_keywords = string_positive_keywords + ", " + positive_keyword

        counter = counter + 1

    # return results
    if counter > 0:
        return config["DEFAULT_FINDING_STRING_PART_1"] + url + config["DEFAULT_FINDING_STRING_PART_2"] + string_positive_keywords
    else:
        return "NO MATCHES"



# Functions reads a config file and stores values in global var
def loadIniConfig():

    try:
        # read config file
        with open('C:/Users/Derek/Desktop/config.json', 'r') as f:
            global config
            config = json.load(f)

            return True
    except:

        return False



# Inlezen initiele configuratie, wanneer er een fout optreedt wordt dit in de console weergegeven
if not loadIniConfig():
    print("Config file read error")

# Scrape page
print(SinglePageScraper("https://dwg.nl", config["KEYWORDS"]))
